"use strict";(self.webpackChunkvuepress_theme_hope_template=self.webpackChunkvuepress_theme_hope_template||[]).push([[6632],{6262:(t,s)=>{s.A=(t,s)=>{const i=t.__vccOpts||t;for(const[t,e]of s)i[t]=e;return i}},3511:(t,s,i)=>{i.r(s),i.d(s,{comp:()=>n,data:()=>l});var e=i(641);const a={},n=(0,i(6262).A)(a,[["render",function(t,s){return(0,e.uX)(),(0,e.CE)("div",null,s[0]||(s[0]=[(0,e.Fv)('<h1 id="熟悉配置文件-etc-logrotate-conf及参数" tabindex="-1"><a class="header-anchor" href="#熟悉配置文件-etc-logrotate-conf及参数"><span>熟悉配置文件 /etc/logrotate.conf及参数</span></a></h1><h2 id="_1-配置文件-etc-logrotate-conf" tabindex="-1"><a class="header-anchor" href="#_1-配置文件-etc-logrotate-conf"><span>1.配置文件 /etc/logrotate.conf</span></a></h2><blockquote><p>比如以系统日志/var/log/message做切割来简单说明下：<br> 第一次执行完rotate(轮转)之后，原本的messages会变成messages.1，而且会制造一个空的messages给系统来储存日志；<br> 第二次执行之后，messages.1会变成messages.2，而messages会变成messages.1，又造成一个空的messages来储存日志！<br> 如果仅设定保留三个日志（即轮转3次）的话，那么执行第三次时，则 messages.3这个档案就会被删除，并由后面的较新的保存日志所取代！也就是会保存最新的几个&gt;日志。<br> 日志究竟轮换几次，这个是根据配置文件中的rotate参数来判定的。</p></blockquote><p>看下logrotate.conf配置：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/logrotate.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这是默认值,如果其他配置文件设定了别的值,就会以别的参数为准</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># see &quot;man logrotate&quot; for details</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># rotate 8log files weekly</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">weekly</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #默认每一周执行一次rotate轮转工作</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># keep 4 weeks worth of backlogs</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">rotate</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #保留多少个日志文件(轮转几次).默认保留四个.就是指定日志文件删除之前轮转的次数，0 指没有备份</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># create new (empty) log files after rotating old ones</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #自动创建新的日志文件，新的日志文件具有和原来的文件相同的权限；因为日志被改名,因此要创建一个新的来继续存储之前的日志</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># use date as a suffix of the rotated file</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">dateext</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #这个参数很重要！就是切割后的日志文件以当前日期为格式结尾，如xxx.log-20131216这样,如果注释掉,切割出来是按数字递增,即前面说的 xxx.log-1这种格式</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># uncomment this if you want your log files compressed</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#compress #是否通过gzip压缩转储以后的日志文件，如xxx.log-20131216.gz ；如果不需要压缩，注释掉就行</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># RPM packages drop log rotation information into this directory</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">include </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/etc/logrotate.d </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#将/etc/logrotate.d/ 目录中的所有文件都加载进来</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># no packages own wtmp and btmp -- we&#39;ll rotate 8them here</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/var/log/wtmp { </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#//仅针对 /var/log/wtmp 所设定的参数</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    monthly </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#每月一次切割,取代默认的一周</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    create </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0664</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> root utmp </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#指定新建的日志文件权限以及所属用户和组</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\tminsize </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1M</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #文件大小超过 1M 后才会切割</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    rotate </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #只8个日志.</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/var/log/btmp {</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    missingok</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    monthly</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    create </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0600</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> root utmp</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    rotate 8</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>这个 wtmp 可记录用户登录系统及系统重启的时间<br> 因为有 minsize 的参数，因此不见得每个月一定会执行一次喔.要看文件大小。</p></blockquote><blockquote><p>由这个文件的设定可以知道/etc/logrotate.d其实就是由/etc/logrotate.conf 所规划出来的目录，虽然可以将所有的配置都写入/etc/logrotate.conf ，但是这&gt;样一来这个文件就实在是太复杂了，尤其是当使用很多的服务在系统上面时， 每个服务都要去修改/etc/logrotate.conf的设定也似乎不太合理了。<br> 所以，如果独立出来一个目录，那么每个要切割日志的服务， 就可以独自成为一个文件，并且放置到 /etc/logrotate.d/ 当中</p></blockquote><h2 id="其他重要参数说明" tabindex="-1"><a class="header-anchor" href="#其他重要参数说明"><span>其他重要参数说明</span></a></h2><table><thead><tr><th>参数名称</th><th>功能描述</th></tr></thead><tbody><tr><td><code>compress</code></td><td>通过 gzip 压缩转储后的日志。</td></tr><tr><td><code>nocompress</code></td><td>禁用 gzip 压缩处理。</td></tr><tr><td><code>copytruncate</code></td><td>备份并截断正在写入的日志文件（先拷贝后清空，可能丢失部分数据）。</td></tr><tr><td><code>nocopytruncate</code></td><td>备份日志文件但不截断原文件。</td></tr><tr><td><code>create</code></td><td>轮转时创建新文件并指定权限、所有者和组（如 <code>create 0777 nobody nobody</code>）。</td></tr><tr><td><code>nocreate</code></td><td>不自动创建新的日志文件。</td></tr><tr><td><code>delaycompress</code></td><td>与 <code>compress</code> 共用，延迟到下一次转储时压缩本次的日志文件。</td></tr><tr><td><code>nodelaycompress</code></td><td>覆盖 <code>delaycompress</code>，立即压缩转储的日志文件。</td></tr><tr><td><code>missingok</code></td><td>如果日志文件不存在，不报错并继续处理。</td></tr><tr><td><code>errors</code></td><td>将转储错误信息发送到指定邮箱地址（如 <code>errors admin@example.com</code>）。</td></tr><tr><td><code>ifempty</code></td><td>即使日志为空也执行轮转（默认行为）。</td></tr><tr><td><code>notifempty</code></td><td>日志文件为空时不进行轮转。</td></tr><tr><td><code>mail</code></td><td>将转储的旧日志文件发送到指定邮箱（如 <code>mail admin@example.com</code>）。</td></tr><tr><td><code>nomail</code></td><td>不通过邮件发送转储的日志文件。</td></tr><tr><td><code>olddir</code></td><td>将转储的日志移动到指定目录（需与原文件在同一文件系统）。</td></tr><tr><td><code>noolddir</code></td><td>转储的日志文件保留在原目录。</td></tr><tr><td><code>sharedscripts</code></td><td>所有日志轮转完成后，统一执行一次 <code>postrotate</code> 脚本（默认每个日志轮转后单独执行脚本）。</td></tr><tr><td><code>prerotate</code></td><td>在轮转前执行自定义命令（需独立成行，以 <code>endscript</code> 结束）。</td></tr><tr><td><code>postrotate</code></td><td>在轮转后执行自定义命令（如重启服务，需独立成行，以 <code>endscript</code> 结束）。</td></tr><tr><td><code>daily</code></td><td>按天轮转日志。</td></tr><tr><td><code>weekly</code></td><td>按周轮转日志。</td></tr><tr><td><code>monthly</code></td><td>按月轮转日志。</td></tr><tr><td><code>rotate</code></td><td>保留的历史日志文件数量（如 <code>rotate 5</code> 保留 5 个备份）。</td></tr><tr><td><code>dateext</code></td><td>使用当前日期作为轮转日志的后缀（默认格式：<code>-YYYYMMDD</code>）。</td></tr><tr><td><code>dateformat</code></td><td>配合 <code>dateext</code> 自定义日期格式（如 <code>.%s</code>，仅支持 <code>%Y %m %d %s</code> 参数）。</td></tr><tr><td><code>size</code></td><td>当日志文件达到指定大小时轮转（如 <code>size 100M</code>，支持单位：<code>k</code>/<code>m</code>）。</td></tr><tr><td><code>minsize</code></td><td>当日志文件达到指定大小时轮转（如 <code>size 100M</code>，支持单位：<code>k</code>/<code>m</code>）。</td></tr></tbody></table>',11)]))}]]),l=JSON.parse('{"path":"/book/Linux/centos/run/01-logrotate/01-config.html","title":"熟悉配置文件及参数","lang":"zh-CN","frontmatter":{"title":"熟悉配置文件及参数","icon":"mdi:math-log","order":1,"category":["linux"],"tag":["centos","logrotate"],"description":"熟悉配置文件 /etc/logrotate.conf及参数 1.配置文件 /etc/logrotate.conf 比如以系统日志/var/log/message做切割来简单说明下： 第一次执行完rotate(轮转)之后，原本的messages会变成messages.1，而且会制造一个空的messages给系统来储存日志； 第二次执行之后，message...","head":[["meta",{"property":"og:url","content":"https://www.youhujun.com/book/Linux/centos/run/01-logrotate/01-config.html"}],["meta",{"property":"og:site_name","content":"游鹄君博客"}],["meta",{"property":"og:title","content":"熟悉配置文件及参数"}],["meta",{"property":"og:description","content":"熟悉配置文件 /etc/logrotate.conf及参数 1.配置文件 /etc/logrotate.conf 比如以系统日志/var/log/message做切割来简单说明下： 第一次执行完rotate(轮转)之后，原本的messages会变成messages.1，而且会制造一个空的messages给系统来储存日志； 第二次执行之后，message..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-18T10:34:42.000Z"}],["meta",{"property":"article:tag","content":"centos"}],["meta",{"property":"article:tag","content":"logrotate"}],["meta",{"property":"article:modified_time","content":"2025-02-18T10:34:42.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"熟悉配置文件及参数\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-02-18T10:34:42.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"游鹄君\\",\\"url\\":\\"https://youhujun.github.io\\"}]}"]]},"headers":[{"level":2,"title":"1.配置文件 /etc/logrotate.conf","slug":"_1-配置文件-etc-logrotate-conf","link":"#_1-配置文件-etc-logrotate-conf","children":[]},{"level":2,"title":"其他重要参数说明","slug":"其他重要参数说明","link":"#其他重要参数说明","children":[]}],"git":{"createdTime":1739874882000,"updatedTime":1739874882000,"contributors":[{"name":"youhujun","username":"youhujun","email":"2900976495@qq.com","commits":1}]},"readingTime":{"minutes":4.4,"words":1319},"filePathRelative":"book/Linux/centos/run/01-logrotate/01-config.md","localizedDate":"2025年2月18日","excerpt":"\\n<h2>1.配置文件 /etc/logrotate.conf</h2>\\n<blockquote>\\n<p>比如以系统日志/var/log/message做切割来简单说明下：<br>\\n第一次执行完rotate(轮转)之后，原本的messages会变成messages.1，而且会制造一个空的messages给系统来储存日志；<br>\\n第二次执行之后，messages.1会变成messages.2，而messages会变成messages.1，又造成一个空的messages来储存日志！<br>\\n如果仅设定保留三个日志（即轮转3次）的话，那么执行第三次时，则 messages.3这个档案就会被删除，并由后面的较新的保存日志所取代！也就是会保存最新的几个&gt;日志。<br>\\n日志究竟轮换几次，这个是根据配置文件中的rotate参数来判定的。</p>\\n</blockquote>","autoDesc":true}')}}]);