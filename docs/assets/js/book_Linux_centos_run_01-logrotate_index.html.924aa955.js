"use strict";(self.webpackChunkvuepress_theme_hope_template=self.webpackChunkvuepress_theme_hope_template||[]).push([[5748],{6262:(e,i)=>{i.A=(e,i)=>{const s=e.__vccOpts||e;for(const[e,t]of i)s[e]=t;return s}},5228:(e,i,s)=>{s.r(i),s.d(i,{comp:()=>n,data:()=>l});var t=s(641);const a={},n=(0,s(6262).A)(a,[["render",function(e,i){const s=(0,t.g2)("Catalog");return(0,t.uX)(),(0,t.CE)("div",null,[(0,t.bF)(s),i[0]||(i[0]=(0,t.Fv)('<h1 id="简介" tabindex="-1"><a class="header-anchor" href="#简介"><span>简介</span></a></h1><blockquote><p>Linux系统默认安装logrotate工具，它默认的配置文件在：<br> /etc/logrotate.conf<br> /etc/logrotate.d/</p></blockquote><blockquote><p>logrotate.conf 才主要的配置文件，logrotate.d 是一个目录，该目录里的所有文件都会被主动的读入/etc/logrotate.conf中执行。<br> 另外，如果 /etc/logrotate.d/ 里面的文件中没有设定一些细节，则会以/etc/logrotate.conf这个文件的设定来作为默认值。</p></blockquote><blockquote><p>Logrotate是基于CRON来运行的，其脚本是/etc/cron.daily/logrotate，日志轮转是系统自动完成的。<br> 实际运行时，Logrotate会调用配置文件/etc/logrotate.conf。<br> 可以在/etc/logrotate.d目录里放置自定义好的配置文件，用来覆盖Logrotate的缺省值。</p></blockquote><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/sh</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/sbin/logrotate</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/lib/logrotate/logrotate.status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/logrotate.conf</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">EXITVALUE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">$?</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$EXITVALUE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    /usr/bin/logger</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> logrotate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;ALERT exited abnormally with [</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$EXITVALUE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">exit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>如果等不及cron自动执行日志轮转，想手动强制切割日志，需要加-f参数；不过正式执行前最好通过Debug选项来验证一下（-d参数），这对调试也很重要</p></blockquote><blockquote><p>/usr/sbin/logrotate -f /etc/logrotate.d/nginx<br> /usr/sbin/logrotate -d -f /etc/logrotate.d/nginx</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>logrotate命令格式：</span></span>\n<span class="line"><span>logrotate [OPTION...] &lt;configfile&gt;</span></span>\n<span class="line"><span>-d, --debug ：debug模式，测试配置文件是否有错误。</span></span>\n<span class="line"><span>-f, --force ：强制转储文件。</span></span>\n<span class="line"><span>-m, --mail=command ：压缩日志后，发送日志到指定邮箱。</span></span>\n<span class="line"><span>-s, --state=statefile ：使用指定的状态文件。</span></span>\n<span class="line"><span>-v, --verbose ：显示转储过程。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="根据日志切割设置进行操作-并显示详细信息" tabindex="-1"><a class="header-anchor" href="#根据日志切割设置进行操作-并显示详细信息"><span>根据日志切割设置进行操作，并显示详细信息</span></a></h2><blockquote><p>/usr/sbin/logrotate -v /etc/logrotate.conf<br> /usr/sbin/logrotate -v /etc/logrotate.d/php</p></blockquote><h2 id="根据日志切割设置进行执行-并显示详细信息-但是不进行具体操作-debug模式" tabindex="-1"><a class="header-anchor" href="#根据日志切割设置进行执行-并显示详细信息-但是不进行具体操作-debug模式"><span>根据日志切割设置进行执行，并显示详细信息,但是不进行具体操作，debug模式</span></a></h2><blockquote><p>/usr/sbin/logrotate -d /etc/logrotate.conf<br> /usr/sbin/logrotate -d /etc/logrotate.d/nginx</p></blockquote><h2 id="查看各log文件的具体执行情况" tabindex="-1"><a class="header-anchor" href="#查看各log文件的具体执行情况"><span>查看各log文件的具体执行情况</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/lib/logrotate.status</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="注意问题" tabindex="-1"><a class="header-anchor" href="#注意问题"><span>注意问题</span></a></h1><h2 id="问题一-要在linux下创建配置文件" tabindex="-1"><a class="header-anchor" href="#问题一-要在linux下创建配置文件"><span>问题一:要在linux下创建配置文件</span></a></h2><p>否则会因为文件权限问题报错</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>error: Ignoring 文件路径 because it is writable by group or others.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="问题二-因为切割日志文件目录权限问题-需要在配置文件添加" tabindex="-1"><a class="header-anchor" href="#问题二-因为切割日志文件目录权限问题-需要在配置文件添加"><span>问题二:因为切割日志文件目录权限问题,需要在配置文件添加</span></a></h2><blockquote><p>su 用户 用户组 例如: su root root</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>error: skipping &quot;日志文件路径&quot; because parent directory has insecure permissions (It&#39;s world writable or writable by group which is not &quot;root&quot;) Set &quot;su&quot; directive in config file to tell logrotate which user/group should be used for rotation.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>',21))])}]]),l=JSON.parse('{"path":"/book/Linux/centos/run/01-logrotate/","title":"日志切割之Logrotate","lang":"zh-CN","frontmatter":{"title":"日志切割之Logrotate","index":true,"icon":"mdi:math-log","dir":{"order":3},"category":["Linux","logrotate"],"head":[["meta",{"property":"og:url","content":"https://www.youhujun.com/book/Linux/centos/run/01-logrotate/"}],["meta",{"property":"og:site_name","content":"游鹄君博客"}],["meta",{"property":"og:title","content":"日志切割之Logrotate"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-18T10:34:42.000Z"}],["meta",{"property":"article:modified_time","content":"2025-02-18T10:34:42.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"日志切割之Logrotate\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-02-18T10:34:42.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"游鹄君\\",\\"url\\":\\"https://youhujun.github.io\\"}]}"]]},"headers":[{"level":2,"title":"根据日志切割设置进行操作，并显示详细信息","slug":"根据日志切割设置进行操作-并显示详细信息","link":"#根据日志切割设置进行操作-并显示详细信息","children":[]},{"level":2,"title":"根据日志切割设置进行执行，并显示详细信息,但是不进行具体操作，debug模式","slug":"根据日志切割设置进行执行-并显示详细信息-但是不进行具体操作-debug模式","link":"#根据日志切割设置进行执行-并显示详细信息-但是不进行具体操作-debug模式","children":[]},{"level":2,"title":"查看各log文件的具体执行情况","slug":"查看各log文件的具体执行情况","link":"#查看各log文件的具体执行情况","children":[]},{"level":2,"title":"问题一:要在linux下创建配置文件","slug":"问题一-要在linux下创建配置文件","link":"#问题一-要在linux下创建配置文件","children":[]},{"level":2,"title":"问题二:因为切割日志文件目录权限问题,需要在配置文件添加","slug":"问题二-因为切割日志文件目录权限问题-需要在配置文件添加","link":"#问题二-因为切割日志文件目录权限问题-需要在配置文件添加","children":[]}],"git":{"createdTime":1739874882000,"updatedTime":1739874882000,"contributors":[{"name":"youhujun","username":"youhujun","email":"2900976495@qq.com","commits":1}]},"readingTime":{"minutes":1.81,"words":544},"filePathRelative":"book/Linux/centos/run/01-logrotate/README.md","localizedDate":"2025年2月18日","excerpt":""}')}}]);